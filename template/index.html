<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Agentic AI Platform</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts - Inter -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6;
            display: flex;
            justify-content: center;
            align-items: flex-start; /* Align to top for longer content */
            min-height: 100vh;
            padding: 2rem 1rem; /* Added padding for overall layout */
        }
        .container {
            max-width: 1200px;
            width: 100%;
            background-color: #ffffff;
            border-radius: 1.5rem; /* More rounded corners */
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
            overflow: hidden; /* Ensures rounded corners are visible */
        }
        .tab-button {
            padding: 0.75rem 1.5rem;
            border-bottom: 3px solid transparent;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease-in-out;
            color: #4b5563; /* Gray text */
        }
        .tab-button.active {
            border-color: #4f46e5; /* Indigo-600 for active tab */
            color: #4f46e5; /* Indigo-600 text for active */
            background-color: #eef2ff; /* Light indigo background */
        }
        .tab-button:hover:not(.active) {
            background-color: #f9fafb; /* Lighter gray on hover */
            color: #1f2937; /* Darker text on hover */
        }
        .tab-content {
            display: none;
            padding: 2rem;
            border-top: 1px solid #e5e7eb;
        }
        .tab-content.active {
            display: block;
        }
        .api-section {
            background-color: #f9fafb;
            border-radius: 0.75rem;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            border: 1px solid #e5e7eb;
        }
        .api-section h3 {
            font-size: 1.25rem;
            font-weight: 600;
            color: #1f2937;
            margin-bottom: 1rem;
        }
        input[type="text"], input[type="number"], textarea, select { /* Added select */
            width: 100%;
            padding: 0.75rem;
            border: 1px solid #d1d5db;
            border-radius: 0.5rem;
            margin-top: 0.5rem;
            margin-bottom: 1rem;
            font-size: 1rem;
            color: #374151;
            box-shadow: inset 0 1px 2px rgba(0, 0, 0, 0.05);
            transition: border-color 0.2s;
        }
        input[type="text"]:focus, input[type="number"]:focus, textarea:focus, select:focus {
            outline: none;
            border-color: #6366f1; /* Indigo-500 on focus */
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.2); /* Focus ring */
        }
        button {
            background-color: #4f46e5; /* Indigo-600 */
            color: white;
            padding: 0.75rem 1.5rem;
            border-radius: 0.75rem; /* Slightly more rounded */
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.2s ease-in-out, transform 0.1s ease;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }
        button:hover {
            background-color: #4338ca; /* Indigo-700 */
            transform: translateY(-1px);
        }
        button:active {
            transform: translateY(0);
            box-shadow: none;
        }
        button:disabled {
            background-color: #a5b4fc; /* Indigo-300 */
            cursor: not-allowed;
        }
        .loading-spinner {
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-top: 4px solid #fff;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
            margin-left: 0.5rem;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        pre {
            background-color: #1f2937; /* Darker gray for code */
            color: #e5e7eb;
            padding: 1rem;
            border-radius: 0.5rem;
            overflow-x: auto;
            white-space: pre-wrap; /* Wrap long lines */
            word-wrap: break-word;
            font-size: 0.875rem;
            line-height: 1.5;
            box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.2);
        }
        .result-box {
            margin-top: 1.5rem;
            padding: 1rem;
            background-color: #e0f2fe; /* Light blue for success */
            border-radius: 0.75rem;
            border: 1px solid #90cdf4;
            color: #2c5282;
            font-weight: 500;
        }
        .error-box {
            margin-top: 1.5rem;
            padding: 1rem;
            background-color: #fee2e2; /* Light red for error */
            border-radius: 0.75rem;
            border: 1px solid #ef4444;
            color: #be123c;
            font-weight: 500;
        }
        /* Analytics Cards */
        .analytics-card {
            background-color: #ffffff;
            border-radius: 0.75rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            padding: 1.5rem;
            border: 1px solid #e5e7eb;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            height: 100%; /* Ensure cards fill height in grid */
        }
        .analytics-card-title {
            font-size: 1.125rem;
            font-weight: 600;
            color: #374151;
            margin-bottom: 0.75rem;
        }
        .analytics-metric {
            font-size: 1.875rem;
            font-weight: 700;
            color: #1f2937;
            margin-bottom: 0.5rem;
        }
        .analytics-description {
            font-size: 0.875rem;
            color: #6b7280;
            margin-bottom: 1rem;
        }
        .analytics-detail {
            font-size: 0.875rem;
            color: #4b5563;
            margin-top: 0.5rem;
        }
        .analytics-trend-positive {
            color: #10b981; /* Green */
            font-weight: 600;
        }
        .analytics-trend-negative {
            color: #ef4444; /* Red */
            font-weight: 600;
        }
        /* Responsive adjustments */
        @media (max-width: 768px) {
            .tab-button {
                padding: 0.5rem 1rem;
                font-size: 0.875rem;
            }
            .tab-content {
                padding: 1.5rem;
            }
            .api-section {
                padding: 1rem;
                margin-bottom: 1rem;
            }
            input[type="text"], input[type="number"], textarea, button {
                padding: 0.6rem;
                font-size: 0.9rem;
            }
            button {
                width: 100%; /* Full width buttons on small screens */
            }
            .flex-wrap-md {
                flex-wrap: wrap; /* Allow tabs to wrap on smaller screens */
            }
        }
    </style>
</head>
<body class="bg-gray-100 p-8">
    <div class="container">
        <header class="bg-gradient-to-r from-indigo-600 to-indigo-800 p-6 text-white text-center rounded-t-xl shadow-lg">
            <h1 class="text-3xl font-bold mb-2">ðŸ¤– Agentic AI Platform</h1>
            <p class="text-indigo-200">Interact with your Customer Support, Marketing, PVA, and Trading AI Agents</p>
        </header>

        <div class="flex border-b border-gray-200 bg-white flex-wrap-md" id="agent-tabs">
            <button class="tab-button active" data-tab="system-agent">System</button>
            <button class="tab-button" data-tab="customer-support-agent">Customer Support</button>
            <button class="tab-button" data-tab="financial-trading-bot">Financial Trading</button>
            <button class="tab-button" data-tab="marketing-agent">Marketing</button>
            <button class="tab-button" data-tab="pva-agent">PVA</button>
            <button class="tab-button" data-tab="admin-panel">Admin Panel</button>
        </div>

        <div id="tab-content-container">
            <!-- System Agent Tab -->
            <div id="system-agent" class="tab-content active">
                <h2 class="text-2xl font-bold text-gray-800 mb-6">System Agent</h2>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="api-section">
                        <h3>Overall System Status (Public)</h3>
                        <p class="text-gray-600 mb-4">Get a quick overview of the API system's status.</p>
                        <button onclick="getSystemStatus()">
                            Get Status
                            <span id="system-status-loading" class="loading-spinner hidden"></span>
                        </button>
                        <div id="system-status-result" class="result-box hidden"></div>
                        <div id="system-status-error" class="error-box hidden"></div>
                    </div>

                    <div class="api-section">
                        <h3>Detailed System Metrics (Auth Required)</h3>
                        <p class="text-gray-600 mb-4">Retrieve in-depth system performance and agent metrics.</p>
                        <button onclick="getDetailedSystemMetrics()">
                            Get Detailed Metrics
                            <span id="detailed-metrics-loading" class="loading-spinner hidden"></span>
                        </button>
                        <div id="detailed-metrics-result" class="result-box hidden"></div>
                        <div id="detailed-metrics-error" class="error-box hidden"></div>
                    </div>

                    <div class="api-section">
                        <h3>Run System Diagnostics (Auth Required)</h3>
                        <p class="text-gray-600 mb-4">Run comprehensive diagnostics on the system and agents.</p>
                        <button onclick="runSystemDiagnostics()">
                            Run Diagnostics
                            <span id="diagnostics-loading" class="loading-spinner hidden"></span>
                        </button>
                        <div id="diagnostics-result" class="result-box hidden"></div>
                        <div id="diagnostics-error" class="error-box hidden"></div>
                    </div>

                    <div class="api-section">
                        <h3>Get Health Check (Public)</h3>
                        <p class="text-gray-600 mb-4">Check the detailed health status of the API and its agents.</p>
                        <button onclick="getHealthCheck()">
                            Run Health Check
                            <span id="health-check-loading" class="loading-spinner hidden"></span>
                        </button>
                        <div id="health-check-result" class="result-box hidden"></div>
                        <div id="health-check-error" class="error-box hidden"></div>
                    </div>

                    <div class="api-section md:col-span-2">
                        <h3>List Available Agents (Public)</h3>
                        <p class="text-gray-600 mb-4">See all active agents and their capabilities.</p>
                        <button onclick="listAvailableAgents()">
                            List Agents
                            <span id="list-agents-loading" class="loading-spinner hidden"></span>
                        </button>
                        <div id="list-agents-result" class="result-box hidden"></div>
                        <div id="list-agents-error" class="error-box hidden"></div>
                    </div>
                </div>
            </div>

            <!-- Customer Support Tab -->
            <div id="customer-support-agent" class="tab-content">
                <h2 class="text-2xl font-bold text-gray-800 mb-6">Customer Support Agent</h2>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="api-section">
                        <h3>Customer Support Chat (Public)</h3>
                        <p class="text-gray-600 mb-4">Engage with the customer support agent.</p>
                        <label for="cs-customer-id" class="block text-gray-700 font-medium">Customer ID:</label>
                        <input type="number" id="cs-customer-id" value="123" placeholder="Enter Customer ID" required>

                        <label for="cs-message" class="block text-gray-700 font-medium">Message:</label>
                        <textarea id="cs-message" rows="3" placeholder="Type your message here..." required>My internet is not working.</textarea>

                        <button onclick="customerSupportChat()">
                            Send Message
                            <span id="cs-chat-loading" class="loading-spinner hidden"></span>
                        </button>
                        <div id="cs-chat-result" class="result-box hidden"></div>
                        <div id="cs-chat-error" class="error-box hidden"></div>
                    </div>

                    <div class="api-section">
                        <h3>Get Customer Context (Auth Required)</h3>
                        <p class="text-gray-600 mb-4">Retrieve detailed context for a customer.</p>
                        <label for="context-customer-id" class="block text-gray-700 font-medium">Customer ID:</label>
                        <input type="number" id="context-customer-id" value="123" placeholder="Enter Customer ID" required>

                        <button onclick="getCustomerContext()">
                            Get Context
                            <span id="cs-context-loading" class="loading-spinner hidden"></span>
                        </button>
                        <div id="cs-context-result" class="result-box hidden"></div>
                        <div id="cs-context-error" class="error-box hidden"></div>
                    </div>

                    <div class="api-section">
                        <h3>Debug Customer Context (Auth Required)</h3>
                        <p class="text-gray-600 mb-4">Get debug information for a specific customer ID.</p>
                        <label for="debug-customer-id" class="block text-gray-700 font-medium">Customer ID:</label>
                        <input type="number" id="debug-customer-id" value="123" placeholder="Enter Customer ID" required>
                        <button onclick="debugCustomerContext()">
                            Get Debug Info
                            <span id="cs-debug-loading" class="loading-spinner hidden"></span>
                        </button>
                        <div id="cs-debug-result" class="result-box hidden"></div>
                        <div id="cs-debug-error" class="error-box hidden"></div>
                    </div>

                    <div class="api-section">
                        <h3>Get Customer Insights (Auth Required)</h3>
                        <p class="text-gray-600 mb-4">Get comprehensive insights for a customer.</p>
                        <label for="insights-customer-id" class="block text-gray-700 font-medium">Customer ID:</label>
                        <input type="number" id="insights-customer-id" value="123" placeholder="Enter Customer ID" required>
                        <button onclick="getCustomerInsights()">
                            Get Insights
                            <span id="cs-insights-loading" class="loading-spinner hidden"></span>
                        </button>
                        <div id="cs-insights-result" class="result-box hidden"></div>
                        <div id="cs-insights-error" class="error-box hidden"></div>
                    </div>
                </div>
            </div>

            <!-- Financial Trading Bot Tab -->
            <div id="financial-trading-bot" class="tab-content">
                <h2 class="text-2xl font-bold text-gray-800 mb-6">Financial Trading Bot (Auth Required)</h2>
                <p class="text-gray-600 mb-4">All Financial Trading Bot features require authentication.</p>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="api-section">
                        <h3>Analyze Market & Make Decision</h3>
                        <p class="text-gray-600 mb-4">Get a trading decision based on symbol and strategy.</p>
                        <label for="trading-analyze-symbol" class="block text-gray-700 font-medium">Stock Symbol:</label>
                        <input type="text" id="trading-analyze-symbol" value="GOOGL" placeholder="e.g., GOOGL" required>
                        <label for="trading-strategy-type" class="block text-gray-700 font-medium">Strategy Type:</label>
                        <select id="trading-strategy-type" class="w-full p-2 border rounded-md mt-1 mb-3">
                            <option value="momentum">Momentum</option>
                            <option value="mean_reversion">Mean Reversion</option>
                            <option value="arbitrage">Arbitrage</option>
                        </select>
                        <button onclick="analyzeAndDecide()">
                            Analyze & Decide
                            <span id="ft-analyze-loading" class="loading-spinner hidden"></span>
                        </button>
                        <div id="ft-analyze-result" class="result-box hidden"></div>
                        <div id="ft-analyze-error" class="error-box hidden"></div>
                    </div>

                    <div class="api-section">
                        <h3>Run Trading Cycle</h3>
                        <p class="text-gray-600 mb-4">Simulate a trading cycle for specified symbols (optional).</p>
                        <label for="trading-cycle-symbols" class="block text-gray-700 font-medium">Symbols (comma-separated):</label>
                        <input type="text" id="trading-cycle-symbols" value="AAPL,MSFT" placeholder="e.g., AAPL,MSFT">
                        <button onclick="runTradingCycle()">
                            Run Cycle
                            <span id="ft-cycle-loading" class="loading-spinner hidden"></span>
                        </button>
                        <div id="ft-cycle-result" class="result-box hidden"></div>
                        <div id="ft-cycle-error" class="error-box hidden"></div>
                    </div>

                    <div class="api-section">
                        <h3>Get Portfolio Status</h3>
                        <p class="text-gray-600 mb-4">View the current status of the trading bot's portfolio.</p>
                        <button onclick="getPortfolioStatus()">
                            Get Portfolio
                            <span id="ft-portfolio-loading" class="loading-spinner hidden"></span>
                        </button>
                        <div id="ft-portfolio-result" class="result-box hidden"></div>
                        <div id="ft-portfolio-error" class="error-box hidden"></div>
                    </div>

                    <div class="api-section">
                        <h3>Get Market Data</h3>
                        <p class="text-gray-600 mb-4">Retrieve real-time market data for a specific stock symbol.</p>
                        <label for="market-symbol" class="block text-gray-700 font-medium">Stock Symbol:</label>
                        <input type="text" id="market-symbol" value="AAPL" placeholder="Enter stock symbol (e.g., AAPL)" required>

                        <button onclick="getMarketData()">
                            Get Data
                            <span id="ft-market-loading" class="loading-spinner hidden"></span>
                        </button>
                        <div id="ft-market-result" class="result-box hidden"></div>
                        <div id="ft-market-error" class="error-box hidden"></div>
                    </div>

                    <div class="api-section">
                        <h3>Get Performance Report</h3>
                        <p class="text-gray-600 mb-4">Retrieve a comprehensive performance report of the trading activities.</p>
                        <button onclick="getPerformanceReport()">
                            Get Report
                            <span id="ft-performance-loading" class="loading-spinner hidden"></span>
                        </button>
                        <div id="ft-performance-result" class="result-box hidden"></div>
                        <div id="ft-performance-error" class="error-box hidden"></div>
                    </div>

                    <div class="api-section">
                        <h3>Get Current Holdings</h3>
                        <p class="text-gray-600 mb-4">View the trading bot's current stock holdings.</p>
                        <button onclick="getCurrentHoldings()">
                            Get Holdings
                            <span id="ft-holdings-loading" class="loading-spinner hidden"></span>
                        </button>
                        <div id="ft-holdings-result" class="result-box hidden"></div>
                        <div id="ft-holdings-error" class="error-box hidden"></div>
                    </div>

                    <div class="api-section">
                        <h3>Get Risk Assessment</h3>
                        <p class="text-gray-600 mb-4">Retrieve the current risk assessment for the portfolio.</p>
                        <button onclick="getRiskAssessment()">
                            Get Risk
                            <span id="ft-risk-loading" class="loading-spinner hidden"></span>
                        </button>
                        <div id="ft-risk-result" class="result-box hidden"></div>
                        <div id="ft-risk-error" class="error-box hidden"></div>
                    </div>

                    <div class="api-section">
                        <h3>Get Watchlist</h3>
                        <p class="text-gray-600 mb-4">View the trading bot's watchlist of monitored symbols.</p>
                        <button onclick="getWatchlist()">
                            Get Watchlist
                            <span id="ft-watchlist-loading" class="loading-spinner hidden"></span>
                        </button>
                        <div id="ft-watchlist-result" class="result-box hidden"></div>
                        <div id="ft-watchlist-error" class="error-box hidden"></div>
                    </div>
                </div>
            </div>

            <!-- Marketing Agent Tab -->
            <div id="marketing-agent" class="tab-content">
                <h2 class="text-2xl font-bold text-gray-800 mb-6">Marketing Agent (Auth Required)</h2>
                <p class="text-gray-600 mb-4">All Marketing Agent features require authentication.</p>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="api-section">
                        <h3>Create Marketing Campaign</h3>
                        <p class="text-gray-600 mb-4">Generate a new marketing campaign plan.</p>
                        <label for="campaign-type" class="block text-gray-700 font-medium">Campaign Type:</label>
                        <input type="text" id="campaign-type" value="product_launch" placeholder="e.g., product_launch" required>

                        <label for="target-audience" class="block text-gray-700 font-medium">Target Audience:</label>
                        <input type="text" id="target-audience" value="tech enthusiasts" placeholder="e.g., tech enthusiasts" required>

                        <label for="budget" class="block text-gray-700 font-medium">Budget:</label>
                        <input type="number" id="budget" value="5000" placeholder="e.g., 5000" required>

                        <label for="duration-days" class="block text-gray-700 font-medium">Duration (Days):</label>
                        <input type="number" id="duration-days" value="30" placeholder="e.g., 30" required>

                        <button onclick="createMarketingCampaign()">
                            Create Campaign
                            <span id="mk-campaign-loading" class="loading-spinner hidden"></span>
                        </button>
                        <div id="mk-campaign-result" class="result-box hidden"></div>
                        <div id="mk-campaign-error" class="error-box hidden"></div>
                    </div>

                    <div class="api-section">
                        <h3>Generate Marketing Content</h3>
                        <p class="text-gray-600 mb-4">Generate content for a specific platform and theme.</p>
                        <label for="content-platform" class="block text-gray-700 font-medium">Platform:</label>
                        <input type="text" id="content-platform" value="social_media" placeholder="e.g., social_media, email">
                        <label for="content-type" class="block text-gray-700 font-medium">Content Type:</label>
                        <input type="text" id="content-type" value="post" placeholder="e.g., post, article">
                        <label for="content-campaign-theme" class="block text-gray-700 font-medium">Campaign Theme:</label>
                        <input type="text" id="content-campaign-theme" value="new_product" placeholder="e.g., new_product">
                        <button onclick="generateMarketingContent()">
                            Generate Content
                            <span id="mk-content-loading" class="loading-spinner hidden"></span>
                        </button>
                        <div id="mk-content-result" class="result-box hidden"></div>
                        <div id="mk-content-error" class="error-box hidden"></div>
                    </div>

                    <div class="api-section">
                        <h3>Analyze Campaign Performance</h3>
                        <p class="text-gray-600 mb-4">Get performance metrics for a specific campaign ID.</p>
                        <label for="campaign-performance-id" class="block text-gray-700 font-medium">Campaign ID:</label>
                        <input type="text" id="campaign-performance-id" value="campaign_001" placeholder="Enter Campaign ID">
                        <button onclick="analyzeCampaignPerformance()">
                            Analyze Performance
                            <span id="mk-performance-loading" class="loading-spinner hidden"></span>
                        </button>
                        <div id="mk-performance-result" class="result-box hidden"></div>
                        <div id="mk-performance-error" class="error-box hidden"></div>
                    </div>

                    <div class="api-section">
                        <h3>Get Campaign List</h3>
                        <p class="text-gray-600 mb-4">Retrieve a list of marketing campaigns with optional status filter.</p>
                        <label for="campaign-list-status" class="block text-gray-700 font-medium">Status Filter (optional):</label>
                        <input type="text" id="campaign-list-status" value="" placeholder="e.g., active, completed">
                        <label for="campaign-list-limit" class="block text-gray-700 font-medium">Limit:</label>
                        <input type="number" id="campaign-list-limit" value="5" min="1">
                        <button onclick="getCampaignList()">
                            Get List
                            <span id="mk-list-loading" class="loading-spinner hidden"></span>
                        </button>
                        <div id="mk-list-result" class="result-box hidden"></div>
                        <div id="mk-list-error" class="error-box hidden"></div>
                    </div>

                    <div class="api-section">
                        <h3>Get Content Templates</h3>
                        <p class="text-gray-600 mb-4">Retrieve available marketing content templates by type (optional).</p>
                        <label for="template-content-type" class="block text-gray-700 font-medium">Content Type (optional):</label>
                        <input type="text" id="template-content-type" value="" placeholder="e.g., social_media, email">
                        <button onclick="getContentTemplates()">
                            Get Templates
                            <span id="mk-templates-loading" class="loading-spinner hidden"></span>
                        </button>
                        <div id="mk-templates-result" class="result-box hidden"></div>
                        <div id="mk-templates-error" class="error-box hidden"></div>
                    </div>

                    <div class="api-section">
                        <h3>Get Marketing Trends</h3>
                        <p class="text-gray-600 mb-4">Discover current marketing trends and insights.</p>
                        <button onclick="getMarketingTrends()">
                            Get Trends
                            <span id="mk-trends-loading" class="loading-spinner hidden"></span>
                        </button>
                        <div id="mk-trends-result" class="result-box hidden"></div>
                        <div id="mk-trends-error" class="error-box hidden"></div>
                    </div>

                    <div class="api-section">
                        <h3>Get Audience Segments</h3>
                        <p class="text-gray-600 mb-4">Retrieve available audience segments for targeting.</p>
                        <button onclick="getAudienceSegments()">
                            Get Segments
                            <span id="mk-segments-loading" class="loading-spinner hidden"></span>
                        </button>
                        <div id="mk-segments-result" class="result-box hidden"></div>
                        <div id="mk-segments-error" class="error-box hidden"></div>
                    </div>

                    <div class="api-section">
                        <h3>Pause/Resume Campaign</h3>
                        <p class="text-gray-600 mb-4">Pause or resume a marketing campaign.</p>
                        <label for="campaign-action-id" class="block text-gray-700 font-medium">Campaign ID:</label>
                        <input type="text" id="campaign-action-id" value="fallback_campaign_001" placeholder="Enter Campaign ID">
                        <button onclick="pauseCampaign()">
                            Pause Campaign
                            <span id="mk-pause-loading" class="loading-spinner hidden"></span>
                        </button>
                        <button onclick="resumeCampaign()">
                            Resume Campaign
                            <span id="mk-resume-loading" class="loading-spinner hidden"></span>
                        </button>
                        <div id="mk-action-result" class="result-box hidden"></div>
                        <div id="mk-action-error" class="error-box hidden"></div>
                    </div>
                </div>
            </div>

            <!-- Personal Virtual Assistant (PVA) Tab -->
            <div id="pva-agent" class="tab-content">
                <h2 class="text-2xl font-bold text-gray-800 mb-6">Personal Virtual Assistant (PVA) (Auth Required)</h2>
                <p class="text-gray-600 mb-4">All PVA features require authentication.</p>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="api-section">
                        <h3>PVA Chat</h3>
                        <p class="text-gray-600 mb-4">Chat with your Personal Virtual Assistant.</p>
                        <label for="pva-user-id" class="block text-gray-700 font-medium">User ID:</label>
                        <input type="text" id="pva-user-id" value="user_123" placeholder="Enter User ID" required>

                        <label for="pva-message" class="block text-gray-700 font-medium">Message:</label>
                        <textarea id="pva-message" rows="3" placeholder="Type your message here..." required>Set a reminder for me to call John tomorrow at 10 AM.</textarea>

                        <button onclick="pvaChat()">
                            Send Message
                            <span id="pva-chat-loading" class="loading-spinner hidden"></span>
                        </button>
                        <div id="pva-chat-result" class="result-box hidden"></div>
                        <div id="pva-chat-error" class="error-box hidden"></div>
                    </div>

                    <div class="api-section">
                        <h3>Get User Reminders</h3>
                        <p class="text-gray-600 mb-4">Retrieve a list of reminders for a user.</p>
                        <label for="reminders-user-id" class="block text-gray-700 font-medium">User ID:</label>
                        <input type="text" id="reminders-user-id" value="user_123" placeholder="Enter User ID" required>

                        <button onclick="getUserReminders()">
                            Get Reminders
                            <span id="pva-reminders-loading" class="loading-spinner hidden"></span>
                        </button>
                        <div id="pva-reminders-result" class="result-box hidden"></div>
                        <div id="pva-reminders-error" class="error-box hidden"></div>
                    </div>

                    <div class="api-section">
                        <h3>Get User Devices</h3>
                        <p class="text-gray-600 mb-4">Retrieve a list of smart devices for a user.</p>
                        <label for="devices-user-id" class="block text-gray-700 font-medium">User ID:</label>
                        <input type="text" id="devices-user-id" value="user_123" placeholder="Enter User ID" required>
                        <button onclick="getUserDevices()">
                            Get Devices
                            <span id="pva-devices-loading" class="loading-spinner hidden"></span>
                        </button>
                        <div id="pva-devices-result" class="result-box hidden"></div>
                        <div id="pva-devices-error" class="error-box hidden"></div>
                    </div>

                    <div class="api-section">
                        <h3>Get User Context</h3>
                        <p class="text-gray-600 mb-4">Retrieve user preferences and interaction history.</p>
                        <label for="context-user-id" class="block text-gray-700 font-medium">User ID:</label>
                        <input type="text" id="context-user-id" value="user_123" placeholder="Enter User ID" required>
                        <button onclick="getUserContext()">
                            Get Context
                            <span id="pva-context-loading" class="loading-spinner hidden"></span>
                        </button>
                        <div id="pva-context-result" class="result-box hidden"></div>
                        <div id="pva-context-error" class="error-box hidden"></div>
                    </div>

                    <div class="api-section">
                        <h3>Control Smart Device</h3>
                        <p class="text-gray-600 mb-4">Send commands to a smart home device.</p>
                        <label for="control-user-id" class="block text-gray-700 font-medium">User ID:</label>
                        <input type="text" id="control-user-id" value="user_123" required>
                        <label for="device-id" class="block text-gray-700 font-medium">Device ID:</label>
                        <input type="text" id="device-id" value="device_001" placeholder="e.g., device_001" required>
                        <label for="device-action" class="block text-gray-700 font-medium">Action:</label>
                        <input type="text" id="device-action" value="turn_on" placeholder="e.g., turn_on, turn_off" required>
                        <label for="device-parameters" class="block text-gray-700 font-medium">Parameters (JSON, optional):</label>
                        <textarea id="device-parameters" rows="2" placeholder='{"brightness": 80}'></textarea>
                        <button onclick="controlSmartDevice()">
                            Control Device
                            <span id="pva-control-loading" class="loading-spinner hidden"></span>
                        </button>
                        <div id="pva-control-result" class="result-box hidden"></div>
                        <div id="pva-control-error" class="error-box hidden"></div>
                    </div>

                    <div class="api-section">
                        <h3>Create Reminder</h3>
                        <p class="text-gray-600 mb-4">Create a new reminder for the user.</p>
                        <label for="reminder-user-id" class="block text-gray-700 font-medium">User ID:</label>
                        <input type="text" id="reminder-user-id" value="user_123" required>
                        <label for="reminder-title" class="block text-gray-700 font-medium">Title:</label>
                        <input type="text" id="reminder-title" value="Buy groceries" required>
                        <label for="reminder-description" class="block text-gray-700 font-medium">Description (optional):</label>
                        <input type="text" id="reminder-description" value="Milk, eggs, bread">
                        <label for="reminder-time" class="block text-gray-700 font-medium">Target Time (ISO format):</label>
                        <input type="text" id="reminder-time" value="2025-08-11T18:00:00" placeholder="YYYY-MM-DDTHH:MM:SS" required>
                        <button onclick="createReminder()">
                            Create Reminder
                            <span id="pva-create-reminder-loading" class="loading-spinner hidden"></span>
                        </button>
                        <div id="pva-create-reminder-result" class="result-box hidden"></div>
                        <div id="pva-create-reminder-error" class="error-box hidden"></div>
                    </div>

                    <div class="api-section">
                        <h3>Get User Calendar</h3>
                        <p class="text-gray-600 mb-4">Retrieve calendar events for a user for a number of days.</p>
                        <label for="calendar-user-id" class="block text-gray-700 font-medium">User ID:</label>
                        <input type="text" id="calendar-user-id" value="user_123" required>
                        <label for="calendar-days" class="block text-gray-700 font-medium">Days (from today):</label>
                        <input type="number" id="calendar-days" value="7" min="1" max="30">
                        <button onclick="getUserCalendar()">
                            Get Calendar
                            <span id="pva-calendar-loading" class="loading-spinner hidden"></span>
                        </button>
                        <div id="pva-calendar-result" class="result-box hidden"></div>
                        <div id="pva-calendar-error" class="error-box hidden"></div>
                    </div>

                    <div class="api-section">
                        <h3>Get Weather Info</h3>
                        <p class="text-gray-600 mb-4">Get weather information for a location.</p>
                        <label for="weather-user-id" class="block text-gray-700 font-medium">User ID:</label>
                        <input type="text" id="weather-user-id" value="user_123" required>
                        <label for="weather-location" class="block text-gray-700 font-medium">Location (optional):</label>
                        <input type="text" id="weather-location" value="London" placeholder="e.g., London, New York">
                        <button onclick="getWeatherInfo()">
                            Get Weather
                            <span id="pva-weather-loading" class="loading-spinner hidden"></span>
                        </button>
                        <div id="pva-weather-result" class="result-box hidden"></div>
                        <div id="pva-weather-error" class="error-box hidden"></div>
                    </div>

                    <div class="api-section">
                        <h3>Get User Tasks</h3>
                        <p class="text-gray-600 mb-4">Retrieve a list of tasks/to-do items for a user.</p>
                        <label for="tasks-user-id" class="block text-gray-700 font-medium">User ID:</label>
                        <input type="text" id="tasks-user-id" value="user_123" required>
                        <label for="tasks-status" class="block text-gray-700 font-medium">Status (optional):</label>
                        <input type="text" id="tasks-status" value="" placeholder="e.g., pending, completed">
                        <button onclick="getUserTasks()">
                            Get Tasks
                            <span id="pva-tasks-loading" class="loading-spinner hidden"></span>
                        </button>
                        <div id="pva-tasks-result" class="result-box hidden"></div>
                        <div id="pva-tasks-error" class="error-box hidden"></div>
                    </div>

                    <div class="api-section md:col-span-2">
                        <h3>Get PVA Capabilities</h3>
                        <p class="text-gray-600 mb-4">View the capabilities and features of the Personal Virtual Assistant.</p>
                        <button onclick="getPVACapabilities()">
                            Get Capabilities
                            <span id="pva-capabilities-loading" class="loading-spinner hidden"></span>
                        </button>
                        <div id="pva-capabilities-result" class="result-box hidden"></div>
                        <div id="pva-capabilities-error" class="error-box hidden"></div>
                    </div>
                </div>
            </div>

            <!-- Admin Panel Tab (Analytics Dashboard) -->
            <div id="admin-panel" class="tab-content">
                <h2 class="text-2xl font-bold text-gray-800 mb-6">ðŸ”‘ Admin Panel (Analytics Dashboard)</h2>
                <p class="text-gray-600 mb-4">This section provides comprehensive analytics and insights across all agents.</p>

                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    <div class="lg:col-span-3">
                        <div class="analytics-card">
                            <h3 class="analytics-card-title">Overall Analytics Overview</h3>
                            <div id="overall-analytics-content" class="text-gray-700">
                                <!-- Data will be injected here -->
                            </div>
                            <button class="mt-4" onclick="getAnalyticsDashboard()">
                                Refresh Dashboard
                                <span id="analytics-dashboard-loading" class="loading-spinner hidden"></span>
                            </button>
                            <div id="analytics-dashboard-error" class="error-box hidden mt-4"></div>
                        </div>
                    </div>

                    <div class="analytics-card">
                        <h3 class="analytics-card-title">Total Customers Analytics</h3>
                        <div id="customers-analytics-content" class="text-gray-700">
                            <!-- Data will be injected here -->
                        </div>
                        <button class="mt-4" onclick="getTotalCustomersAnalytics()">
                            Get Customer Analytics
                            <span id="analytics-customers-loading" class="loading-spinner hidden"></span>
                        </button>
                        <div id="analytics-customers-error" class="error-box hidden mt-4"></div>
                    </div>

                    <div class="analytics-card">
                        <h3 class="analytics-card-title">Active Campaigns Analytics</h3>
                        <div id="campaigns-analytics-content" class="text-gray-700">
                            <!-- Data will be injected here -->
                        </div>
                        <button class="mt-4" onclick="getActiveCampaignsAnalytics()">
                            Get Campaign Analytics
                            <span id="analytics-campaigns-loading" class="loading-spinner hidden"></span>
                        </button>
                        <div id="analytics-campaigns-error" class="error-box hidden mt-4"></div>
                    </div>

                    <div class="analytics-card">
                        <h3 class="analytics-card-title">Knowledge Base Analytics</h3>
                        <div id="knowledge-base-analytics-content" class="text-gray-700">
                            <!-- Data will be injected here -->
                        </div>
                        <button class="mt-4" onclick="getKnowledgeBaseAnalytics()">
                            Get KB Analytics
                            <span id="analytics-kb-loading" class="loading-spinner hidden"></span>
                        </button>
                        <div id="analytics-kb-error" class="error-box hidden mt-4"></div>
                    </div>

                    <div class="analytics-card">
                        <h3 class="analytics-card-title">API Status Analytics</h3>
                        <div id="api-status-analytics-content" class="text-gray-700">
                            <!-- Data will be injected here -->
                        </div>
                        <button class="mt-4" onclick="getApiStatusAnalytics()">
                            Get API Status
                            <span id="analytics-api-loading" class="loading-spinner hidden"></span>
                        </button>
                        <div id="analytics-api-error" class="error-box hidden mt-4"></div>
                    </div>

                    <div class="analytics-card">
                        <h3 class="analytics-card-title">Customer Support Agent Analytics</h3>
                        <div id="cs-agent-analytics-content" class="text-gray-700">
                            <!-- Data will be injected here -->
                        </div>
                        <button class="mt-4" onclick="getCustomerSupportAgentAnalytics()">
                            Get CS Agent Analytics
                            <span id="analytics-cs-agent-loading" class="loading-spinner hidden"></span>
                        </button>
                        <div id="analytics-cs-agent-error" class="error-box hidden mt-4"></div>
                    </div>

                    <div class="analytics-card">
                        <h3 class="analytics-card-title">Marketing Agent Analytics</h3>
                        <div id="marketing-agent-analytics-content" class="text-gray-700">
                            <!-- Data will be injected here -->
                        </div>
                        <button class="mt-4" onclick="getMarketingAgentAnalytics()">
                            Get Marketing Agent Analytics
                            <span id="analytics-marketing-agent-loading" class="loading-spinner hidden"></span>
                        </button>
                        <div id="analytics-marketing-agent-error" class="error-box hidden mt-4"></div>
                    </div>

                     <div class="analytics-card">
                        <h3 class="analytics-card-title">PVA Agent Analytics</h3>
                        <div id="pva-agent-analytics-content" class="text-gray-700">
                            <!-- Data will be injected here -->
                        </div>
                        <button class="mt-4" onclick="getPVAAgentAnalytics()">
                            Get PVA Agent Analytics
                            <span id="analytics-pva-agent-loading" class="loading-spinner hidden"></span>
                        </button>
                        <div id="analytics-pva-agent-error" class="error-box hidden mt-4"></div>
                    </div>

                    <div class="analytics-card">
                        <h3 class="analytics-card-title">Financial Trading Bot Analytics</h3>
                        <div id="trading-bot-analytics-content" class="text-gray-700">
                            <!-- Data will be injected here -->
                        </div>
                        <button class="mt-4" onclick="getTradingBotAnalytics()">
                            Get Trading Bot Analytics
                            <span id="analytics-trading-bot-loading" class="loading-spinner hidden"></span>
                        </button>
                        <div id="analytics-trading-bot-error" class="error-box hidden mt-4"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Smart environment detection
        function getApiBase() {
            const hostname = window.location.hostname;
            if (hostname === 'localhost' || hostname === '127.0.0.1' || hostname.startsWith('192.168.') || hostname.startsWith('10.') || hostname.startsWith('172.')) {
                return 'http://localhost:8000';
            }
            return 'https://fe69745cefee.ngrok-free.app'; // Replace with your actual ngrok URL or deployed URL
        }

        const API_BASE_URL = getApiBase();
        const API_TOKEN = 'demo-token-123'; // Hardcoded API token for demo purposes

        console.log(`Using API_BASE_URL: ${API_BASE_URL}`);

        // API Endpoints
        const ENDPOINTS = {
            // Main and System Endpoints
            root: `${API_BASE_URL}/`,
            systemStatus: `${API_BASE_URL}/api/v1/system/status`,
            detailedSystemMetrics: `${API_BASE_URL}/api/v1/system/metrics`, // Auth required
            listAgents: `${API_BASE_URL}/api/v1/agents/list`,
            healthCheck: `${API_BASE_URL}/health`,
            systemDiagnostics: `${API_BASE_URL}/api/v1/diagnostics`, // Auth required

            // Customer Support Endpoints
            customerSupportChat: `${API_BASE_URL}/api/v1/customer-support/chat`,
            customerContext: `${API_BASE_URL}/api/v1/customer-support/customer`, // Append /{customer_id}
            debugCustomerContext: `${API_BASE_URL}/api/v1/customer-support/debug`, // Append /{customer_id} - Auth required
            customerInsights: `${API_BASE_URL}/api/v1/customer-support/customer`, // Append /{customer_id}/insights - Auth required

            // Financial Trading Bot Endpoints (All Auth required as per FastAPI)
            analyzeAndDecide: `${API_BASE_URL}/api/v1/trading/analyze`,
            runTradingCycle: `${API_BASE_URL}/api/v1/trading/cycle`,
            portfolioStatus: `${API_BASE_URL}/api/v1/trading/portfolio`,
            marketData: `${API_BASE_URL}/api/v1/trading/market`, // Append /{symbol}
            performanceReport: `${API_BASE_URL}/api/v1/trading/performance`,
            currentHoldings: `${API_BASE_URL}/api/v1/trading/holdings`,
            riskAssessment: `${API_BASE_URL}/api/v1/trading/risk-assessment`,
            watchlist: `${API_BASE_URL}/api/v1/trading/watchlist`,

            // Marketing Agent Endpoints (All Auth required as per FastAPI)
            createMarketingCampaign: `${API_BASE_URL}/api/v1/marketing/campaign/create`,
            generateMarketingContent: `${API_BASE_URL}/api/v1/marketing/content/generate`,
            analyzeCampaignPerformance: `${API_BASE_URL}/api/v1/marketing/campaign`, // Append /{campaign_id}/performance
            campaignList: `${API_BASE_URL}/api/v1/marketing/campaigns`,
            contentTemplates: `${API_BASE_URL}/api/v1/marketing/templates`,
            marketingTrends: `${API_BASE_URL}/api/v1/marketing/insights/trends`,
            audienceSegments: `${API_BASE_URL}/api/v1/marketing/audience/segments`,
            pauseCampaign: `${API_BASE_URL}/api/v1/marketing/campaign`, // Append /{campaign_id}/pause
            resumeCampaign: `${API_BASE_URL}/api/v1/marketing/campaign`, // Append /{campaign_id}/resume

            // Personal Virtual Assistant (PVA) Endpoints (All Auth required as per FastAPI)
            pvaChat: `${API_BASE_URL}/api/v1/pva/chat`,
            userReminders: `${API_BASE_URL}/api/v1/pva/user`, // Append /{user_id}/reminders
            userDevices: `${API_BASE_URL}/api/v1/pva/user`, // Append /{user_id}/devices
            userContext: `${API_BASE_URL}/api/v1/pva/user`, // Append /{user_id}/context
            controlSmartDevice: `${API_BASE_URL}/api/v1/pva/user`, // Append /{user_id}/device/{device_id}/control
            createReminder: `${API_BASE_URL}/api/v1/pva/user`, // Append /{user_id}/reminder
            userCalendar: `${API_BASE_URL}/api/v1/pva/user`, // Append /{user_id}/calendar
            weatherInfo: `${API_BASE_URL}/api/v1/pva/user`, // Append /{user_id}/weather
            userTasks: `${API_BASE_URL}/api/v1/pva/user`, // Append /{user_id}/tasks
            pvaCapabilities: `${API_BASE_URL}/api/v1/pva/capabilities`,

            // Analytics Dashboard Endpoints (All Auth required as per FastAPI)
            analyticsDashboard: `${API_BASE_URL}/api/v1/analytics/dashboard`,
            analyticsCustomers: `${API_BASE_URL}/api/v1/analytics/customers`,
            analyticsCampaigns: `${API_BASE_URL}/api/v1/analytics/campaigns`,
            analyticsKnowledgeBase: `${API_BASE_URL}/api/v1/analytics/knowledge-base`,
            analyticsApiStatus: `${API_BASE_URL}/api/v1/analytics/api-status`,
            analyticsCSAgent: `${API_BASE_URL}/api/v1/analytics/agents/customer-support`,
            analyticsMarketingAgent: `${API_BASE_URL}/api/v1/analytics/agents/marketing`,
            analyticsPVAAgent: `${API_BASE_URL}/api/v1/analytics/agents/personal-virtual-assistant`,
            analyticsTradingBot: `${API_BASE_URL}/api/v1/analytics/agents/financial-trading-bot`
        };

            // Utility function to fetch data
            async function fetchData(
                url,
                method = 'GET',
                body = null,
                ui = {}
            ) {
                const {
                    loadingElementId,
                    resultElementId,
                    errorElementId,
                    renderAsAnalytics = false
                } = ui;

                const headers = {
                    'Content-Type': 'application/json',
                    'ngrok-skip-browser-warning': 'true' // Keep this for ngrok
                };

                // Show loading spinner
                const loadingSpinner = document.getElementById(loadingElementId);
                if (loadingSpinner) loadingSpinner.classList.remove('hidden');

                // Clear previous results/errors
                const resultElement = document.getElementById(resultElementId);
                const errorElement = document.getElementById(errorElementId);
                resultElement.classList.add('hidden');
                errorElement.classList.add('hidden');
                resultElement.innerHTML = ''; // Clear content too
                errorElement.innerHTML = ''; // Clear content too

                let authRequired = false; // Define authRequired and default to false
                if (url.includes('/api/v1/trading/') || url.includes('/api/v1/marketing/') || url.includes('/api/v1/pva/') || url.includes('/api/v1/system/metrics') || url.includes('/api/v1/customer-support/debug') || url.includes('/api/v1/customer-support/customer')) {
                    authRequired = true;
                }

                if (url.includes('/api/v1/customer-support/chat')) {
                    authRequired = true;
                }

                // If authentication is required, use the hardcoded API_TOKEN
                if (authRequired) {
                    headers['Authorization'] = `Bearer ${API_TOKEN}`;
                }

                const options = {
                    method: method,
                    headers: headers,
                };

                if (body) {
                    options.body = JSON.stringify(body);
                }

            try {
                const response = await fetch(url, options);
                const data = await response.json();

                if (!response.ok) {
                    let errorMessage = `Error ${response.status}: `;
                    if (response.status === 503) {
                        errorMessage = "Service Unavailable: The server is temporarily unable to handle the request. Please try again later.";
                    }
                    else if (data.detail) {
                        errorMessage += JSON.stringify(data.detail); // Display detail as JSON
                    } else if (data.error) {
                        errorMessage += data.error;
                    } else {
                        errorMessage += 'Unknown error';
                    }
                    displayError(errorElementId, errorMessage);
                    console.log("URL BEING CALLED", url)
                    return;
                }

                if (renderAsAnalytics) {
                    renderAnalyticsData(resultElementId, data);
                } else {
                    displayResult(resultElementId, data);
                }
            } catch (error) {
                console.error('Fetch error:', error);
                displayError(errorElementId, `Network or unknown error: ${error.message}`);
            } finally {
                // Hide loading spinner
                if (loadingSpinner) loadingSpinner.classList.add('hidden');
            }
        }

        function displayResult(elementId, data) {
            const element = document.getElementById(elementId);
            element.innerHTML = `<pre>${JSON.stringify(data, null, 2)}</pre>`;
            element.classList.remove('hidden');
            element.classList.remove('error-box');
            element.classList.add('result-box');
        }

        function displayError(elementId, message) {
            const element = document.getElementById(elementId);
            element.innerHTML = `<p>${message}</p>`;
            element.classList.remove('hidden');
            element.classList.remove('result-box');
            element.classList.add('error-box');
        }

        function renderAnalyticsData(elementId, data) {
            const element = document.getElementById(elementId);
            let htmlContent = '';

            // Guard against empty or null data objects for analytics rendering
            if (!data || Object.keys(data).length === 0) {
                element.innerHTML = `<p class="text-gray-500">No analytics data available for this section.</p>`;
                element.classList.remove('hidden');
                return;
            }

            switch (elementId) {
                case 'overall-analytics-content':
                    htmlContent = renderOverallAnalytics(data);
                    break;
                case 'customers-analytics-content':
                    htmlContent = renderCustomersAnalytics(data);
                    break;
                case 'campaigns-analytics-content':
                    htmlContent = renderCampaignsAnalytics(data);
                    break;
                case 'knowledge-base-analytics-content':
                    htmlContent = renderKnowledgeBaseAnalytics(data);
                    break;
                case 'api-status-analytics-content':
                    htmlContent = renderApiStatusAnalytics(data);
                    break;
                case 'cs-agent-analytics-content':
                    htmlContent = renderCSAgentAnalytics(data);
                    break;
                case 'marketing-agent-analytics-content':
                    htmlContent = renderMarketingAgentAnalytics(data);
                    break;
                case 'pva-agent-analytics-content':
                    htmlContent = renderPVAAgentAnalytics(data);
                    break;
                case 'trading-bot-analytics-content':
                    htmlContent = renderTradingBotAnalytics(data);
                    break;
                default:
                    htmlContent = `<pre>${JSON.stringify(data, null, 2)}</pre>`;
                    break;
            }
            element.innerHTML = htmlContent;
            element.classList.remove('hidden');
        }

        function renderOverallAnalytics(data) {
            const totalRequests = data.total_requests || 0;
            const activeAgents = data.active_agents || 0;
            const averageResponseTime = data.average_response_time || 0;
            const errorRate = data.error_rate || 0;
            const mostActiveAgent = data.most_active_agent || 'N/A';
            const timestamp = data.timestamp ? new Date(data.timestamp).toLocaleString() : 'N/A';

            return `
                <p class="analytics-description">Key metrics for overall system performance.</p>
                <p class="analytics-metric">${totalRequests} <span class="text-lg font-medium text-gray-500">requests</span></p>
                <p class="analytics-detail">Active Agents: <span class="font-semibold">${activeAgents}</span></p>
                <p class="analytics-detail">Avg. Response Time: <span class="font-semibold">${averageResponseTime.toFixed(2)}ms</span></p>
                <p class="analytics-detail">Error Rate: <span class="${errorRate > 0.05 ? 'analytics-trend-negative' : 'analytics-trend-positive'} font-semibold">${(errorRate * 100).toFixed(2)}%</span></p>
                <p class="analytics-detail">Most Active Agent: <span class="font-semibold">${mostActiveAgent}</span></p>
                <p class="analytics-detail text-xs text-gray-400 mt-2">Last Updated: ${timestamp}</p>
            `;
        }

        function renderCustomersAnalytics(data) {
            const totalCustomers = data.total_customers || 0;
            const newCustomersLast30Days = data.new_customers_last_30_days || 0;
            const customerChurnRate = data.customer_churn_rate || 0;
            const averageInteractionsPerCustomer = data.average_interactions_per_customer || 0;
            const customerGrowthTrend = data.customer_growth_trend || 'N/A';

            return `
                <p class="analytics-description">Insights into your customer base.</p>
                <p class="analytics-metric">${totalCustomers.toLocaleString()} <span class="text-lg font-medium text-gray-500">customers</span></p>
                <p class="analytics-detail">New Last 30 Days: <span class="analytics-trend-positive font-semibold">${newCustomersLast30Days}</span></p>
                <p class="analytics-detail">Churn Rate: <span class="${customerChurnRate > 0.05 ? 'analytics-trend-negative' : 'analytics-trend-positive'} font-semibold">${(customerChurnRate * 100).toFixed(2)}%</span></p>
                <p class="analytics-detail">Avg. Interactions: <span class="font-semibold">${averageInteractionsPerCustomer.toFixed(1)}</span></p>
                <p class="analytics-detail">Growth Trend: <span class="${customerGrowthTrend === 'up' ? 'analytics-trend-positive' : 'analytics-trend-negative'} font-semibold">${customerGrowthTrend}</span></p>
            `;
        }

        function renderCampaignsAnalytics(data) {
            const activeCampaigns = data.active_campaigns || 0;
            const totalCampaigns = data.total_campaigns || 0;
            const completedCampaigns = data.completed_campaigns || 0;
            const averageRoi = data.average_roi || 0;
            const conversionRate = data.conversion_rate || 0;
            const campaignEngagementRate = data.campaign_engagement_rate || 0;
            const topPerformingCampaignName = data.top_performing_campaigns?.[0]?.name || 'N/A';

            return `
                <p class="analytics-description">Performance metrics for marketing campaigns.</p>
                <p class="analytics-metric">${activeCampaigns} / ${totalCampaigns} <span class="text-lg font-medium text-gray-500">active</span></p>
                <p class="analytics-detail">Completed: <span class="font-semibold">${completedCampaigns}</span></p>
                <p class="analytics-detail">Avg. ROI: <span class="${averageRoi >= 0 ? 'analytics-trend-positive' : 'analytics-trend-negative'} font-semibold">${(averageRoi * 100).toFixed(2)}%</span></p>
                <p class="analytics-detail">Conversion Rate: <span class="analytics-trend-positive font-semibold">${(conversionRate * 100).toFixed(2)}%</span></p>
                <p class="analytics-detail">Engagement Rate: <span class="font-semibold">${(campaignEngagementRate * 100).toFixed(2)}%</span></p>
                <p class="analytics-detail">Top Campaign: <span class="font-semibold">${topPerformingCampaignName}</span></p>
            `;
        }

        function renderKnowledgeBaseAnalytics(data) {
            const totalArticles = data.total_articles || 0;
            const mostViewedArticle = data.most_viewed_article || 'N/A';
            const searchHitRate = data.search_hit_rate || 0;
            const topSearchQuery = data.top_search_queries?.[0] || 'N/A';

            return `
                <p class="analytics-description">Effectiveness of your knowledge base.</p>
                <p class="analytics-metric">${totalArticles} <span class="text-lg font-medium text-gray-500">articles</span></p>
                <p class="analytics-detail">Most Viewed: <span class="font-semibold">${mostViewedArticle}</span></p>
                <p class="analytics-detail">Search Hit Rate: <span class="analytics-trend-positive font-semibold">${(searchHitRate * 100).toFixed(2)}%</span></p>
                <p class="analytics-detail">Top Query: <span class="font-semibold">${topSearchQuery}</span></p>
            `;
        }

        function renderApiStatusAnalytics(data) {
            const serviceUptime = data.service_uptime || 0;
            const averageLatencyMs = data.latency_metrics?.average_latency_ms || 0;
            const maxLatencyMs = data.latency_metrics?.max_latency_ms || 0;
            const error5xxRate = data.error_rates_by_endpoint?.['5xx_errors'] || 0;
            const totalRequestsTraffic = data.traffic_volume?.total_requests || 0;

            return `
                <p class="analytics-description">Real-time API performance and availability.</p>
                <p class="analytics-metric">${(serviceUptime * 100).toFixed(2)}% <span class="text-lg font-medium text-gray-500">Uptime</span></p>
                <p class="analytics-detail">Avg. Latency: <span class="font-semibold">${averageLatencyMs.toFixed(2)}ms</span></p>
                <p class="analytics-detail">Max Latency: <span class="font-semibold">${maxLatencyMs.toFixed(2)}ms</span></p>
                <p class="analytics-detail">Error Rate (5xx): <span class="${error5xxRate > 0 ? 'analytics-trend-negative' : 'analytics-trend-positive'} font-semibold">${(error5xxRate * 100).toFixed(2)}%</span></p>
                <p class="analytics-detail">Traffic Volume: <span class="font-semibold">${totalRequestsTraffic} requests</span></p>
            `;
        }

        function renderCSAgentAnalytics(data) {
            const totalChats = data.total_chats || 0;
            const averageResolutionTimeMinutes = data.average_resolution_time_minutes || 0;
            const customerSatisfactionScore = data.customer_satisfaction_score || 0;
            const escalationRate = data.escalation_rate || 0;

            return `
                <p class="analytics-description">Customer Support Agent performance.</p>
                <p class="analytics-metric">${totalChats} <span class="text-lg font-medium text-gray-500">chats</span></p>
                <p class="analytics-detail">Avg. Resolution Time: <span class="font-semibold">${averageResolutionTimeMinutes.toFixed(1)} min</span></p>
                <p class="analytics-detail">CSAT Score: <span class="${customerSatisfactionScore >= 4 ? 'analytics-trend-positive' : 'analytics-trend-negative'} font-semibold">${customerSatisfactionScore.toFixed(1)}/5</span></p>
                <p class="analytics-detail">Escalation Rate: <span class="${escalationRate > 0.1 ? 'analytics-trend-negative' : 'analytics-trend-positive'} font-semibold">${(escalationRate * 100).toFixed(2)}%</span></p>
            `;
        }

        function renderMarketingAgentAnalytics(data) {
            const campaignsCreated = data.campaigns_created || 0;
            const contentGenerated = data.content_generated || 0;
            const leadConversionRate = data.lead_conversion_rate || 0;
            const marketingRoiTrends = data.marketing_roi_trends || 'N/A';

            return `
                <p class="analytics-description">Marketing Agent activity and impact.</p>
                <p class="analytics-metric">${campaignsCreated} <span class="text-lg font-medium text-gray-500">campaigns</span></p>
                <p class="analytics-detail">Content Generated: <span class="font-semibold">${contentGenerated} units</span></p>
                <p class="analytics-detail">Lead Conv. Rate: <span class="analytics-trend-positive font-semibold">${(leadConversionRate * 100).toFixed(2)}%</span></p>
                <p class="analytics-detail">ROI Trend: <span class="${marketingRoiTrends === 'up' ? 'analytics-trend-positive' : 'analytics-trend-negative'} font-semibold">${marketingRoiTrends}</span></p>
            `;
        }

        function renderPVAAgentAnalytics(data) {
            const totalInteractions = data.total_interactions || 0;
            const averageSessionDurationSeconds = data.average_session_duration_seconds || 0;
            const taskCompletionRate = data.task_completion_rate || 0;
            const smartDeviceCommandsIssued = data.smart_device_commands_issued || 0;

            return `
                <p class="analytics-description">Personal Virtual Assistant usage metrics.</p>
                <p class="analytics-metric">${totalInteractions} <span class="text-lg font-medium text-gray-500">interactions</span></p>
                <p class="analytics-detail">Avg. Session Duration: <span class="font-semibold">${averageSessionDurationSeconds.toFixed(1)}s</span></p>
                <p class="analytics-detail">Task Completion Rate: <span class="analytics-trend-positive font-semibold">${(taskCompletionRate * 100).toFixed(2)}%</span></p>
                <p class="analytics-detail">Device Commands: <span class="font-semibold">${smartDeviceCommandsIssued}</span></p>
            `;
        }

        function renderTradingBotAnalytics(data) {
            const tradesExecuted = data.trades_executed || 0;
            const portfolioValue = data.portfolio_value || 0;
            const profitLoss = data.profit_loss || 0;
            const winRate = data.win_rate || 0;
            const riskExposure = data.risk_exposure || 'N/A';

            return `
                <p class="analytics-description">Financial Trading Bot performance summary.</p>
                <p class="analytics-metric">${tradesExecuted} <span class="text-lg font-medium text-gray-500">trades</span></p>
                <p class="analytics-detail">Portfolio Value: <span class="font-semibold">$${portfolioValue.toLocaleString(undefined, {minimumFractionDigits: 2, maximumFractionDigits: 2})}</span></p>
                <p class="analytics-detail">Profit/Loss: <span class="${profitLoss >= 0 ? 'analytics-trend-positive' : 'analytics-trend-negative'} font-semibold">$${profitLoss.toLocaleString(undefined, {minimumFractionDigits: 2, maximumFractionDigits: 2})}</span></p>
                <p class="analytics-detail">Win Rate: <span class="analytics-trend-positive font-semibold">${(winRate * 100).toFixed(2)}%</span></p>
                <p class="analytics-detail">Risk Exposure: <span class="${riskExposure === 'high' ? 'analytics-trend-negative' : 'analytics-trend-positive'} font-semibold">${riskExposure}</span></p>
            `;
        }


        // Tab Switching Logic
        document.getElementById('agent-tabs').addEventListener('click', function(event) {
            const target = event.target;
            if (target.classList.contains('tab-button')) {
                // Remove active class from all buttons and hide all content
                document.querySelectorAll('.tab-button').forEach(button => button.classList.remove('active'));
                document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));

                // Add active class to clicked button and show corresponding content
                target.classList.add('active');
                const tabId = target.dataset.tab;
                document.getElementById(tabId).classList.add('active');

                // Trigger preload for specific tabs
                if (tabId === 'customer-support-agent') {
                    // Preload customer context for default ID 123
                    const customerIdInput = document.getElementById('context-customer-id');
                    if (customerIdInput) {
                        customerIdInput.value = '123'; // Set default value
                        getCustomerContext(); // Trigger context fetch
                    }
                } else if (tabId === 'admin-panel') {
                    // Trigger all analytics fetches for the dashboard view
                    getAnalyticsDashboard();
                    getTotalCustomersAnalytics();
                    getActiveCampaignsAnalytics();
                    getKnowledgeBaseAnalytics();
                    getApiStatusAnalytics();
                    getCustomerSupportAgentAnalytics();
                    getMarketingAgentAnalytics();
                    getPVAAgentAnalytics();
                    getTradingBotAnalytics();
                }
            }
        });


        async function getSystemStatus() {
            await fetchData(
                ENDPOINTS.systemStatus, 'GET', null,
                {
                    loadingElementId: 'system-status-loading',
                    resultElementId: 'system-status-result',
                    errorElementId: 'system-status-error'
                }
            );
        }

        async function getDetailedSystemMetrics() {
            await fetchData(
                ENDPOINTS.detailedSystemMetrics, 'GET', null,
                {
                    loadingElementId: 'detailed-metrics-loading',
                    resultElementId: 'detailed-metrics-result',
                    errorElementId: 'detailed-metrics-error'
                }
            );
        }

        async function runSystemDiagnostics() {
            await fetchData(
                ENDPOINTS.systemDiagnostics, 'GET', null,
                {
                    loadingElementId: 'diagnostics-loading',
                    resultElementId: 'diagnostics-result',
                    errorElementId: 'diagnostics-error'
                }
            );
        }

        async function getHealthCheck() {
            await fetchData(
                ENDPOINTS.healthCheck, 'GET', null,
                {
                    loadingElementId: 'health-check-loading',
                    resultElementId: 'health-check-result',
                    errorElementId: 'health-check-error'
                }
            );
        }

        async function listAvailableAgents() {
            await fetchData(
                ENDPOINTS.listAgents, 'GET', null,
                {
                    loadingElementId: 'list-agents-loading',
                    resultElementId: 'list-agents-result',
                    errorElementId: 'list-agents-error'
                }
            );
        }

        // --- Customer Support Functions ---
        async function customerSupportChat() {
            const customerId = document.getElementById('cs-customer-id').value;
            const message = document.getElementById('cs-message').value;

            if (!customerId || !message) {
                displayError('cs-chat-error', 'Customer ID and message are required.');
                return;
            }

            const body = {
                customer_id: customerId,
                message: message,
            };

            await fetchData(
                ENDPOINTS.customerSupportChat, 'POST', body,
                {
                    loadingElementId: 'cs-chat-loading',
                    resultElementId: 'cs-chat-result',
                    errorElementId: 'cs-chat-error'
                }
            );
        }

        async function getCustomerContext() {
            const customerId = document.getElementById('context-customer-id').value;

            if (!customerId) {
                displayError('cs-context-error', 'Customer ID is required.');
                return;
            }

            // Always call with auth true as per latest setup (even if initially public)
            await fetchData(
                `${ENDPOINTS.customerContext}/${customerId}`, 'GET', null,
                {
                    loadingElementId: 'cs-context-loading',
                    resultElementId: 'cs-context-result',
                    errorElementId: 'cs-context-error'
                }
            );
        }

        async function debugCustomerContext() {
            const customerId = document.getElementById('debug-customer-id').value;
            if (!customerId) {
                displayError('cs-debug-error', 'Customer ID is required.');
                return;
            }
            await fetchData(
                `${ENDPOINTS.debugCustomerContext}/${customerId}`, 'GET', null,
                {
                    loadingElementId: 'cs-debug-loading',
                    resultElementId: 'cs-debug-result',
                    errorElementId: 'cs-debug-error'
                }
            );
        }

        async function getCustomerInsights() {
            const customerId = document.getElementById('insights-customer-id').value;
            if (!customerId) {
                displayError('cs-insights-error', 'Customer ID is required.');
                return;
            }
            await fetchData(
                `${ENDPOINTS.customerInsights}/${customerId}/insights`, 'GET', null,
                {
                    loadingElementId: 'cs-insights-loading',
                    resultElementId: 'cs-insights-result',
                    errorElementId: 'cs-insights-error'
                }
            );
        }

        // --- Financial Trading Bot Functions ---
        async function analyzeAndDecide() {
            const symbol = document.getElementById('trading-analyze-symbol').value;
            const strategyType = document.getElementById('trading-strategy-type').value;
            if (!symbol || !strategyType) {
                displayError('ft-analyze-error', 'Stock symbol and strategy type are required.');
                return;
            }
            const body = { symbol: symbol, strategy_type: strategyType };
            await fetchData(
                ENDPOINTS.analyzeAndDecide, 'POST', body,
                {
                    loadingElementId: 'ft-analyze-loading',
                    resultElementId: 'ft-analyze-result',
                    errorElementId: 'ft-analyze-error'
                }
            );
        }

        async function runTradingCycle() {
            const symbolsInput = document.getElementById('trading-cycle-symbols').value;
            let symbols = [];
            if (symbolsInput) {
                symbols = symbolsInput.split(',').map(s => s.trim()).filter(s => s);
            }
            const body = symbols.length > 0 ? { symbols: symbols } : {};
            await fetchData(
                ENDPOINTS.runTradingCycle, 'POST', body,
                {
                    loadingElementId: 'ft-cycle-loading',
                    resultElementId: 'ft-cycle-result',
                    errorElementId: 'ft-cycle-error'
                }
            );
        }

        async function getPortfolioStatus() {
            await fetchData(
                ENDPOINTS.portfolioStatus, 'GET', null,
                {
                    loadingElementId: 'ft-portfolio-loading',
                    resultElementId: 'ft-portfolio-result',
                    errorElementId: 'ft-portfolio-error'
                }
            );
        }

        async function getMarketData() {
            const symbol = document.getElementById('market-symbol').value;
            if (!symbol) {
                displayError('ft-market-error', 'Stock symbol is required.');
                return;
            }
            await fetchData(
                `${ENDPOINTS.marketData}/${symbol}`, 'GET', null,
                {
                    loadingElementId: 'ft-market-loading',
                    resultElementId: 'ft-market-result',
                    errorElementId: 'ft-market-error'
                }
            );
        }

        async function getPerformanceReport() {
            await fetchData(
                ENDPOINTS.performanceReport, 'GET', null,
                {
                    loadingElementId: 'ft-performance-loading',
                    resultElementId: 'ft-performance-result',
                    errorElementId: 'ft-performance-error'
                }
            );
        }

        async function getCurrentHoldings() {
            await fetchData(
                ENDPOINTS.currentHoldings, 'GET', null,
                {
                    loadingElementId: 'ft-holdings-loading',
                    resultElementId: 'ft-holdings-result',
                    errorElementId: 'ft-holdings-error'
                }
            );
        }

        async function getRiskAssessment() {
            await fetchData(
                ENDPOINTS.riskAssessment, 'GET', null,
                {
                    loadingElementId: 'ft-risk-loading',
                    resultElementId: 'ft-risk-result',
                    errorElementId: 'ft-risk-error'
                }
            );
        }

        async function getWatchlist() {
            await fetchData(
                ENDPOINTS.watchlist, 'GET', null,
                {
                    loadingElementId: 'ft-watchlist-loading',
                    resultElementId: 'ft-watchlist-result',
                    errorElementId: 'ft-watchlist-error'
                }
            );
        }

        // --- Marketing Agent Functions ---
        async function createMarketingCampaign() {
            const campaignType = document.getElementById('campaign-type').value;
            const targetAudience = document.getElementById('target-audience').value;
            const budget = parseFloat(document.getElementById('budget').value);
            const durationDays = parseInt(document.getElementById('duration-days').value);

            if (!campaignType || !targetAudience || isNaN(budget) || isNaN(durationDays)) {
                displayError('mk-campaign-error', 'All campaign fields are required and must be valid numbers for budget/duration.');
                return;
            }

            const body = {
                campaign_type: campaignType,
                target_audience: targetAudience,
                budget: budget,
                duration_days: durationDays,
                goals: ["increase_awareness", "generate_leads"],
                channels: ["social_media", "email"],
                content_requirements: ["social_media", "email"],
                industry: "general",
                brand_voice: "professional",
                geographic_focus: "global",
                competitor_analysis: false,
                ab_testing: true,
                performance_tracking: true,
            };

            await fetchData(
                ENDPOINTS.createMarketingCampaign, 'POST', body,
                {
                    loadingElementId: 'mk-campaign-loading',
                    resultElementId: 'mk-campaign-result',
                    errorElementId: 'mk-campaign-error'
                }
            );
        }

        async function generateMarketingContent() {
            const platform = document.getElementById('content-platform').value;
            const contentType = document.getElementById('content-type').value;
            const campaignTheme = document.getElementById('content-campaign-theme').value;

            if (!platform || !contentType || !campaignTheme) {
                displayError('mk-content-error', 'Platform, Content Type, and Campaign Theme are required.');
                return;
            }

            const body = {
                platform: platform,
                content_type: contentType,
                campaign_theme: campaignTheme,
                target_audience: "general audience",
                key_messages: ["engaging", "innovative", "valuable"],
                brand_voice: "professional",
                call_to_action: "Learn more",
                include_hashtags: true
            };
            await fetchData(
                ENDPOINTS.generateMarketingContent, 'POST', body,
                {
                    loadingElementId: 'mk-content-loading',
                    resultElementId: 'mk-content-result',
                    errorElementId: 'mk-content-error'
                }
            );
        }

        async function analyzeCampaignPerformance() {
            const campaignId = document.getElementById('campaign-performance-id').value;
            if (!campaignId) {
                displayError('mk-performance-error', 'Campaign ID is required.');
                return;
            }
            await fetchData(
                `${ENDPOINTS.analyzeCampaignPerformance}/${campaignId}/performance`, 'GET', null,
                {
                    loadingElementId: 'mk-performance-loading',
                    resultElementId: 'mk-performance-result',
                    errorElementId: 'mk-performance-error'
                }
            );
        }

        async function getCampaignList() {
            const statusFilter = document.getElementById('campaign-list-status').value;
            const limit = document.getElementById('campaign-list-limit').value;
            let url = ENDPOINTS.campaignList;
            const params = new URLSearchParams();
            if (statusFilter) {
                params.append('status', statusFilter);
            }
            if (limit) {
                params.append('limit', limit);
            }
            if ([...params].length > 0) {
                url += `?${params.toString()}`;
            }
            await fetchData(
                url, 'GET', null,
                {
                    loadingElementId: 'mk-list-loading',
                    resultElementId: 'mk-list-result',
                    errorElementId: 'mk-list-error'
                }
            );
        }

        async function getContentTemplates() {
            const contentType = document.getElementById('template-content-type').value;
            let url = ENDPOINTS.contentTemplates;
            if (contentType) {
                url += `?content_type=${encodeURIComponent(contentType)}`;
            }
            await fetchData(
                url, 'GET', null,
                {
                    loadingElementId: 'mk-templates-loading',
                    resultElementId: 'mk-templates-result',
                    errorElementId: 'mk-templates-error'
                }
            );
        }

        async function getMarketingTrends() {
            await fetchData(
                ENDPOINTS.marketingTrends, 'GET', null,
                {
                    loadingElementId: 'mk-trends-loading',
                    resultElementId: 'mk-trends-result',
                    errorElementId: 'mk-trends-error'
                }
            );
        }

        async function getAudienceSegments() {
            await fetchData(
                ENDPOINTS.audienceSegments, 'GET', null,
                {
                    loadingElementId: 'mk-segments-loading',
                    resultElementId: 'mk-segments-result',
                    errorElementId: 'mk-segments-error'
                }
            );
        }

        async function pauseCampaign() {
            const campaignId = document.getElementById('campaign-action-id').value;
            if (!campaignId) {
                displayError('mk-action-error', 'Campaign ID is required to pause.');
                return;
            }
            await fetchData(
                `${ENDPOINTS.pauseCampaign}/${campaignId}/pause`, 'POST', {},
                {
                    loadingElementId: 'mk-pause-loading',
                    resultElementId: 'mk-action-result',
                    errorElementId: 'mk-action-error'
                }
            );
        }

        async function resumeCampaign() {
            const campaignId = document.getElementById('campaign-action-id').value;
            if (!campaignId) {
                displayError('mk-action-error', 'Campaign ID is required to resume.');
                return;
            }
            await fetchData(
                `${ENDPOINTS.resumeCampaign}/${campaignId}/resume`, 'POST', {},
                {
                    loadingElementId: 'mk-resume-loading',
                    resultElementId: 'mk-action-result',
                    errorElementId: 'mk-action-error'
                }
            );
        };

        // --- Personal Virtual Assistant (PVA) Functions ---
        async function pvaChat() {
            const userId = document.getElementById('pva-user-id').value;
            const message = document.getElementById('pva-message').value;

            if (!userId || !message) {
                displayError('pva-chat-error', 'User ID and message are required.');
                return;
            }

            const body = {
                user_id: userId,
                message: message,
            };

            await fetchData(
                ENDPOINTS.pvaChat, 'POST', body,
                {
                    loadingElementId: 'pva-chat-loading',
                    resultElementId: 'pva-chat-result',
                    errorElementId: 'pva-chat-error'
                }
            );
        }

        async function getUserReminders() {
            const userId = document.getElementById('reminders-user-id').value;

            if (!userId) {
                displayError('pva-reminders-error', 'User ID is required.');
                return;
            }

            await fetchData(
                `${ENDPOINTS.userReminders}/${userId}/reminders`, 'GET', null,
                {
                    loadingElementId: 'pva-reminders-loading',
                    resultElementId: 'pva-reminders-result',
                    errorElementId: 'pva-reminders-error'
                }
            );
        }

        async function getUserDevices() {
            const userId = document.getElementById('devices-user-id').value;
            if (!userId) {
                displayError('pva-devices-error', 'User ID is required.');
                return;
            }
            await fetchData(
                `${ENDPOINTS.userDevices}/${userId}/devices`, 'GET', null,
                {
                    loadingElementId: 'pva-devices-loading',
                    resultElementId: 'pva-devices-result',
                    errorElementId: 'pva-devices-error'
                }
            );
        }

        async function getUserContext() {
            const userId = document.getElementById('context-user-id').value;
            if (!userId) {
                displayError('pva-context-error', 'User ID is required.');
                return;
            }
            await fetchData(
                `${ENDPOINTS.userContext}/${userId}/context`, 'GET', null,
                {
                    loadingElementId: 'pva-context-loading',
                    resultElementId: 'pva-context-result',
                    errorElementId: 'pva-context-error'
                }
            );
        }

        async function controlSmartDevice() {
            const userId = document.getElementById('control-user-id').value;
            const deviceId = document.getElementById('device-id').value;
            const action = document.getElementById('device-action').value;
            const parametersText = document.getElementById('device-parameters').value;

            if (!userId || !deviceId || !action) {
                displayError('pva-control-error', 'User ID, Device ID, and Action are required.');
                return;
            }

            let parameters = {};
            if (parametersText) {
                try {
                    parameters = JSON.parse(parametersText);
                } catch (e) {
                    // Handle JSON parsing error by notifying the user and stopping further execution
                    displayError('pva-control-error', 'Invalid JSON for parameters: ' + e.message);
                    return;
                }
            }

            const body = { user_id: userId, device_id: deviceId, action: action, parameters: parameters };
            await fetchData(
                `${ENDPOINTS.controlSmartDevice}/${userId}/device/${deviceId}/control`, 'POST', body,
                {
                    loadingElementId: 'pva-control-loading',
                    resultElementId: 'pva-control-result',
                    errorElementId: 'pva-control-error'
                }
            );
        }

        async function createReminder() {
            const userId = document.getElementById('reminder-user-id').value;
            const title = document.getElementById('reminder-title').value;
            const description = document.getElementById('reminder-description').value;
            const targetTime = document.getElementById('reminder-time').value;

            if (!userId || !title || !targetTime) {
                displayError('pva-create-reminder-error', 'User ID, Title, and Target Time are required.');
                return;
            }

            if (!/^\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}$/.test(targetTime)) {
                displayError('pva-create-reminder-error', 'Target Time must be in YYYY-MM-DDTHH:MM:SS format.');
                return;
            }

            const body = {
                title: title,
                description: description,
                target_time: targetTime,
                priority: "medium",
                category: "general",
                recurring: false
            };

            await fetchData(
                `${ENDPOINTS.createReminder}/${userId}/reminder`, 'POST', body,
                {
                    loadingElementId: 'pva-create-reminder-loading',
                    resultElementId: 'pva-create-reminder-result',
                    errorElementId: 'pva-create-reminder-error'
                }
            );
        }

        async function getUserCalendar() {
            const userId = document.getElementById('calendar-user-id').value;
            const days = document.getElementById('calendar-days').value;
            if (!userId || isNaN(days)) {
                displayError('pva-calendar-error', 'User ID and number of days are required.');
                return;
            }
            await fetchData(
                `${ENDPOINTS.userCalendar}/${userId}/calendar?days=${days}`, 'GET', null,
                {
                    loadingElementId: 'pva-calendar-loading',
                    resultElementId: 'pva-calendar-result',
                    errorElementId: 'pva-calendar-error'
                }
            );
        }

        async function getWeatherInfo() {
            const userId = document.getElementById('weather-user-id').value;
            const location = document.getElementById('weather-location').value;
            if (!userId) {
                displayError('pva-weather-error', 'User ID is required.');
                return;
            }
            let url = `${ENDPOINTS.weatherInfo}/${userId}/weather`;
            if (location) {
                url += `?location=${encodeURIComponent(location)}`;
            }
            await fetchData(
                url, 'GET', null,
                {
                    loadingElementId: 'pva-weather-loading',
                    resultElementId: 'pva-weather-result',
                    errorElementId: 'pva-weather-error'
                }
            );
        }

        async function getUserTasks() {
            const userId = document.getElementById('tasks-user-id').value;
            const status = document.getElementById('tasks-status').value;
            if (!userId) {
                displayError('pva-tasks-error', 'User ID is required.');
                return;
            }
            let url = `${ENDPOINTS.userTasks}/${userId}/tasks`;
            if (status) {
                url += `?status=${status}`;
            }
            await fetchData(
                url, 'GET', null,
                {
                    loadingElementId: 'pva-tasks-loading',
                    resultElementId: 'pva-tasks-result',
                    errorElementId: 'pva-tasks-error'
                }
            );
        }

        async function getPVACapabilities() {
            await fetchData(
                ENDPOINTS.pvaCapabilities, 'GET', null,
                {
                    loadingElementId: 'pva-capabilities-loading',
                    resultElementId: 'pva-capabilities-result',
                    errorElementId: 'pva-capabilities-error'
                }
            );
        }

        // --- Admin Panel Functions (Analytics Dashboard) ---
        async function getAnalyticsDashboard() {
            await fetchData(
                ENDPOINTS.analyticsDashboard, 'GET', null,
                {
                    loadingElementId: 'analytics-dashboard-loading',
                    resultElementId: 'overall-analytics-content',
                    errorElementId: 'analytics-dashboard-error',
                    renderAsAnalytics: true
                }
            );
        }

        async function getTotalCustomersAnalytics() {
            await fetchData(
                ENDPOINTS.analyticsCustomers, 'GET', null,
                {
                    loadingElementId: 'analytics-customers-loading',
                    resultElementId: 'customers-analytics-content',
                    errorElementId: 'analytics-customers-error',
                    renderAsAnalytics: true
                }
            );
        }

        async function getActiveCampaignsAnalytics() {
            await fetchData(
                ENDPOINTS.analyticsCampaigns, 'GET', null,
                {
                    loadingElementId: 'analytics-campaigns-loading',
                    resultElementId: 'campaigns-analytics-content',
                    errorElementId: 'analytics-campaigns-error',
                    renderAsAnalytics: true
                }
            );
        }

        async function getKnowledgeBaseAnalytics() {
            await fetchData(
                ENDPOINTS.analyticsKnowledgeBase, 'GET', null,
                {
                    loadingElementId: 'analytics-kb-loading',
                    resultElementId: 'knowledge-base-analytics-content',
                    errorElementId: 'analytics-kb-error',
                    renderAsAnalytics: true
                }
            );
        }

        async function getApiStatusAnalytics() {
            await fetchData(
                ENDPOINTS.analyticsApiStatus, 'GET', null,
                {
                    loadingElementId: 'analytics-api-loading',
                    resultElementId: 'api-status-analytics-content',
                    errorElementId: 'analytics-api-error',
                    renderAsAnalytics: true
                }
            );
        }

        async function getCustomerSupportAgentAnalytics() {
            await fetchData(
                ENDPOINTS.analyticsCSAgent, 'GET', null,
                {
                    loadingElementId: 'analytics-cs-agent-loading',
                    resultElementId: 'cs-agent-analytics-content',
                    errorElementId: 'analytics-cs-agent-error',
                    renderAsAnalytics: true
                }
            );
        }

        async function getMarketingAgentAnalytics() {
            await fetchData(
                ENDPOINTS.analyticsMarketingAgent, 'GET', null,
                {
                    loadingElementId: 'analytics-marketing-agent-loading',
                    resultElementId: 'marketing-agent-analytics-content',
                    errorElementId: 'analytics-marketing-agent-error',
                    renderAsAnalytics: true
                }
            );
        }

        async function getPVAAgentAnalytics() {
            await fetchData(
                ENDPOINTS.analyticsPVAAgent, 'GET', null,
                {
                    loadingElementId: 'analytics-pva-agent-loading',
                    resultElementId: 'pva-agent-analytics-content',
                    errorElementId: 'analytics-pva-agent-error',
                    renderAsAnalytics: true
                }
            );
        }

        async function getTradingBotAnalytics() {
            await fetchData(
                ENDPOINTS.analyticsTradingBot, 'GET', null,
                {
                    loadingElementId: 'analytics-trading-bot-loading',
                    resultElementId: 'trading-bot-analytics-content',
                    errorElementId: 'analytics-trading-bot-error',
                    renderAsAnalytics: true
                }
            );
        }


        // Initialize with default tab
        document.addEventListener('DOMContentLoaded', function() {
            // Simulate click on the first tab to set it active and trigger any preloads
            document.querySelector('.tab-button[data-tab="system-agent"]').click();

            // Explicitly preload customer context if the customer support tab is active on load
            // This handles cases where the page might reload on the customer support tab.
            if (document.getElementById('customer-support-agent').classList.contains('active')) {
                const customerIdInput = document.getElementById('context-customer-id');
                if (customerIdInput) {
                    customerIdInput.value = '123'; // Set default value
                    getCustomerContext(); // Trigger context fetch
                }
            }
        });
    </script>
</body>
</html>
